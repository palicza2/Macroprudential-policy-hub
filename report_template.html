<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EU Macroprudential Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="assets/styles.css">
    <script src="assets/app.js" defer></script>
</head>
<body>
    <header class="mobile-header">
        <a href="#" class="sidebar-brand" style="margin-bottom:0; font-size: 1.1rem;">ðŸ‡ªðŸ‡º Macro<span>Hub</span></a>
        <button class="menu-btn" onclick="toggleSidebar()">
            <i data-lucide="menu"></i>
        </button>
    </header>

    <div class="overlay" onclick="toggleSidebar()"></div>

    <nav class="sidebar" id="sidebar">
        <a href="#" class="sidebar-brand">ðŸ‡ªðŸ‡º Macro<span>Hub</span></a>

        <div class="nav-group">Dashboard</div>
        <a href="#" class="nav-link active" data-tab="overview">
            <i data-lucide="layout-grid"></i> Overview
        </a>
        <a href="#" class="nav-link" data-tab="news">
            <i data-lucide="newspaper"></i> Latest News
        </a>
        <a href="#" class="nav-link" data-tab="capital">
            <i data-lucide="shield-check"></i> Capital Measures
        </a>
        <a href="#" class="nav-link" data-tab="borrower">
            <i data-lucide="users"></i> Borrower Measures
        </a>

        <div style="margin-top: auto; padding-top: 40px; font-size: 0.75rem; color: #64748b; border-top: 1px solid rgba(255,255,255,0.1);">
            Macroprudential Dashboard v5.4<br>
            Â© 2026 Macro Hub
        </div>
    </nav>

    <main class="main-content">
        <section id="tab-overview" class="tab-content active">
            <h1 id="global-exec">Global Executive Summary</h1>
            <div class="card">
                <div class="ai-box" style="font-size: 1.05rem; background: #f0f7ff; border-color: #3b82f6;">{{ analyses['executive_summary'] | safe }}</div>
            </div>
        </section>

        <section id="tab-news" class="tab-content">
            <h1 id="news-section" class="section-title">Latest Macroprudential News</h1>
            <div class="news-layout">
                <div class="news-main">
                    <div class="card">
                        <div class="card-title">Highlights Summary</div>
                        <div class="ai-box">{{ analyses['news_summary'] }}</div>
                    </div>
                    {{ news_feed_html | safe }}
                </div>
                <aside class="news-sidebar">
                    <div class="card">
                        <div class="card-title">
                            <span>Filters</span>
                            <button class="link-button" id="news-clear">Clear all</button>
                        </div>
                        <input type="text" id="news-search" class="chart-input" placeholder="Search news, tags...">
                        <div class="filter-group">
                            <div class="filter-title">Policy Type</div>
                            <label class="filter-option"><input type="checkbox" data-filter="ccyb" checked> CCyB (Countercyclical)</label>
                            <label class="filter-option"><input type="checkbox" data-filter="syrb" checked> SyRB (Systemic Risk)</label>
                            <label class="filter-option"><input type="checkbox" data-filter="bbm" checked> BBM (Borrower-Based)</label>
                            <label class="filter-option"><input type="checkbox" data-filter="ltv" checked> LTV</label>
                            <label class="filter-option"><input type="checkbox" data-filter="dsti" checked> DSTI</label>
                            <label class="filter-option"><input type="checkbox" data-filter="lti" checked> LTI</label>
                            <label class="filter-option"><input type="checkbox" data-filter="dti" checked> DTI</label>
                        </div>
                        <div class="filter-group">
                            <div class="filter-title">Themes</div>
                            <label class="filter-option"><input type="checkbox" data-filter="real-estate" checked> Real Estate</label>
                            <label class="filter-option"><input type="checkbox" data-filter="capital" checked> Capital</label>
                            <label class="filter-option"><input type="checkbox" data-filter="reciprocation" checked> Reciprocation</label>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title">Trending Topics</div>
                        <div class="tag-cloud">
                            <button class="tag-pill" data-tag="real-estate">#Housing</button>
                            <button class="tag-pill" data-tag="inflation">#Inflation</button>
                            <button class="tag-pill" data-tag="ccyb">#CCyB</button>
                            <button class="tag-pill" data-tag="bbm">#BBM</button>
                            <button class="tag-pill" data-tag="reciprocation">#Reciprocation</button>
                        </div>
                    </div>
                </aside>
            </div>
        </section>

        <section id="tab-capital" class="tab-content">
            <h1 id="capital-section" class="section-title">Capital-based measures</h1>

            <h2 id="ccyb-section">Countercyclical buffer (CCyB)</h2>
        
        <div class="card">
            <div class="card-title">
                <span>Section Summary</span>
                <i data-lucide="info" size="18"></i>
            </div>
            <div class="ai-box">{{ analyses['ccyb_section_summary'] | safe }}</div>
        </div>

        <div class="card">
            <div class="card-title">Adoption Count</div>
            <div class="grid-2">
                <div>
                    {% if plot_files.get('ccyb_diffusion') %}
                        <iframe class="plot-frame" src="{{ plot_files['ccyb_diffusion'] }}" loading="lazy"></iframe>
                        {% if download_links.get('ccyb_diffusion') %}
                            <a class="download-link" href="{{ download_links['ccyb_diffusion'] }}" download>Download data</a>
                        {% endif %}
                    {% else %}
                        <div class="empty-state">No Data</div>
                    {% endif %}
                </div>
                <div class="ai-box">{{ analyses['ccyb_diffusion_analysis'] }}</div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-title">Historical Rates</div>
            <div class="controls-row">
                <input type="text" id="ccyb-country-filter" class="chart-input" placeholder="Filter countries (e.g. HU, FR, DE)">
            </div>
            <div class="plot-inline">{{ plots_inline['ccyb_timeseries'] | safe }}</div>
            <div class="ai-box" style="margin-top:20px">{{ analyses['ccyb_history_analysis'] }}</div>
        </div>

        <div class="card">
            <div class="card-title">Geographic & Comparative View</div>
            <div class="grid-2">
                <div>
                    <h3 class="subtle-title">Map View</h3>
                    {% if plot_files.get('cross_section_map') %}
                        <iframe class="plot-frame" src="{{ plot_files['cross_section_map'] }}" loading="lazy"></iframe>
                    {% else %}
                        <div class="empty-state">No Data</div>
                    {% endif %}
                    <h3 class="subtle-title" style="margin-top:30px;">Comparative Levels</h3>
                    {% if plot_files.get('cross_section_bar') %}
                        <iframe class="plot-frame" src="{{ plot_files['cross_section_bar'] }}" loading="lazy"></iframe>
                    {% else %}
                        <div class="empty-state">No Data</div>
                    {% endif %}
                </div>
                <div class="ai-box"><h4 style="margin-top:0">Detailed Analysis</h4>{{ analyses['ccyb_level_analysis'] | safe }}</div>
            </div>
        </div>

        <div class="card">
             <div class="card-title">Risk Analysis</div>
             <div class="grid-2">
                 <div>
                    {% if plot_files.get('risk_plot') %}
                        <iframe class="plot-frame" src="{{ plot_files['risk_plot'] }}" loading="lazy"></iframe>
                    {% else %}
                        <div class="empty-state">No Data</div>
                    {% endif %}
                 </div>
                 <div class="ai-box">{{ analyses['risk_analysis_text'] }}</div>
             </div>
        </div>

        <div class="card">
            <div class="card-title">Latest Decisions</div>
            {% if table_files.get('ccyb_decisions') %}
                <iframe class="table-frame" src="{{ table_files['ccyb_decisions'] }}" loading="lazy"></iframe>
            {% else %}
                <div class="empty-state">No Data</div>
            {% endif %}
            <div class="ai-box" style="margin-top:20px">{{ analyses['ccyb_decisions_analysis'] }}</div>
        </div>

            <h2 id="syrb-section">Systemic Risk Buffer (SyRB)</h2>

        <div class="card">
            <div class="card-title">Section Summary</div>
            <div class="ai-box">{{ analyses['syrb_section_summary'] | safe }}</div>
        </div>
        
        <div class="card">
            <div class="card-title">Adoption Trend</div>
            <div class="grid-2">
                <div>
                    {% if plot_files.get('syrb_counts_trend') %}
                        <iframe class="plot-frame" src="{{ plot_files['syrb_counts_trend'] }}" loading="lazy"></iframe>
                    {% else %}
                        <div class="empty-state">No Data</div>
                    {% endif %}
                </div>
                <div class="ai-box">{{ analyses['syrb_trend_analysis'] }}</div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-title">Sectoral Focus</div>
            <div class="grid-2">
                <div>
                    {% if plot_files.get('syrb_sector') %}
                        <iframe class="plot-frame" src="{{ plot_files['syrb_sector'] }}" loading="lazy"></iframe>
                    {% else %}
                        <div class="empty-state">No Data</div>
                    {% endif %}
                </div>
                <div class="ai-box">{{ analyses['syrb_sectoral_analysis'] }}</div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">Currently Active SyRB Measures</div>
            {% if table_files.get('syrb_active') %}
                <iframe class="table-frame" src="{{ table_files['syrb_active'] }}" loading="lazy"></iframe>
            {% else %}
                <div class="empty-state">No Data</div>
            {% endif %}
            <div class="ai-box" style="margin-top:20px">{{ analyses['syrb_active_analysis'] }}</div>
        </div>
        
        <div class="card">
            <div class="card-title">Latest Decisions</div>
            {% if table_files.get('syrb_decisions') %}
                <iframe class="table-frame" src="{{ table_files['syrb_decisions'] }}" loading="lazy"></iframe>
            {% else %}
                <div class="empty-state">No Data</div>
            {% endif %}
            <div class="ai-box" style="margin-top:20px">{{ analyses['syrb_decisions_analysis'] }}</div>
        </div>

        </section>

        <section id="tab-borrower" class="tab-content">
            <h1 id="bbm-section" class="section-title">Borrower-based measures</h1>

        <div class="card">
            <div class="card-title">Section Summary</div>
            <div class="ai-box">{{ analyses['bbm_section_summary'] | safe }}</div>
        </div>

        <div class="card">
            <div class="card-title">Adoption Count</div>
            <div class="grid-2">
                <div>
                    {% if plot_files.get('bbm_diffusion') %}
                        <iframe class="plot-frame" src="{{ plot_files['bbm_diffusion'] }}" loading="lazy"></iframe>
                        {% if download_links.get('bbm_diffusion') %}
                            <a class="download-link" href="{{ download_links['bbm_diffusion'] }}" download>Download data</a>
                        {% endif %}
                    {% else %}
                        <div class="empty-state">No Data</div>
                    {% endif %}
                </div>
                <div class="ai-box">{{ analyses['bbm_diffusion_analysis'] }}</div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">Active Measures Cross-Country Comparison</div>
            {% if bbm_ref_date %}<span class="ref-date">Latest reference data: {{ bbm_ref_date }}</span>{% endif %}
            {% if table_files.get('bbm_pivot') %}
                <iframe class="table-frame" src="{{ table_files['bbm_pivot'] }}" loading="lazy"></iframe>
            {% else %}
                <div class="empty-state">No Data</div>
            {% endif %}
            <div class="ai-box" style="margin-top:20px">{{ analyses['bbm_analysis'] }}</div>
        </div>

        <div class="card">
            <div class="card-title">LTV Measures (Loan-to-Value)</div>
            {% if ltv_ref_date %}<span class="ref-date">Latest reference data: {{ ltv_ref_date }}</span>{% endif %}
            {% if table_files.get('ltv_table') %}
                <iframe class="table-frame" src="{{ table_files['ltv_table'] }}" loading="lazy"></iframe>
            {% else %}
                <div class="empty-state">No Data</div>
            {% endif %}
            <div class="ai-box" style="margin-top:20px">{{ analyses['ltv_analysis'] }}</div>
        </div>

            <div class="card">
            <div class="card-title">Latest Borrower-based Measure Decisions</div>
            {% if table_files.get('bbm_decisions') %}
                <iframe class="table-frame" src="{{ table_files['bbm_decisions'] }}" loading="lazy"></iframe>
            {% else %}
                <div class="empty-state">No Data</div>
            {% endif %}
            <div class="ai-box" style="margin-top:20px">{{ analyses['bbm_decisions_analysis'] }}</div>
            </div>
        </section>

    </main>

</body>
</html>