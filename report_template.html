<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EU Macroprudential Policy Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #2c3e50; --secondary: #34495e; --accent: #3498db;
            --bg: #f8f9fa; --card-bg: #ffffff; --text: #2d3436; --border: #dfe6e9;
            --sidebar-width: 260px;
        }
        * { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; min-height: 100vh; }
        
        /* --- SIDEBAR --- */
        .sidebar { 
            width: var(--sidebar-width); 
            background: var(--primary); 
            color: white; 
            position: fixed; 
            height: 100vh; 
            overflow-y: auto; 
            padding: 2rem 1.5rem; 
            z-index: 1000;
            transition: transform 0.3s ease-in-out;
            box-shadow: 4px 0 15px rgba(0,0,0,0.1);
        }
        .sidebar h2 { 
            font-size: 1.1rem; 
            margin-bottom: 2rem; 
            border-bottom: 1px solid rgba(255,255,255,0.1); 
            padding-bottom: 1rem; 
            font-weight: 600;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
        }
        .sidebar h2 i { margin-right: 12px; color: var(--accent); }
        
        .nav-links { list-style: none; padding: 0; }
        .nav-links a { color: rgba(255,255,255,0.75); text-decoration: none; display: block; padding: 0.7rem 0; transition: 0.2s; font-size: 0.9rem; }
        .nav-links a:hover { color: white; transform: translateX(5px); }
        .nav-group { margin-top: 2rem; color: #bdc3c7; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.2px; font-weight: 700; margin-bottom: 0.5rem; }
        
        /* Close button for mobile sidebar */
        .close-sidebar-btn { display: none; color: white; font-size: 1.5rem; position: absolute; top: 1rem; right: 1rem; cursor: pointer; }

        /* --- MAIN CONTENT --- */
        .main-content { margin-left: var(--sidebar-width); flex: 1; padding: 3rem 4rem; max-width: 1600px; width: 100%; transition: margin-left 0.3s ease; }
        
        /* Mobile Toggle Button */
        .mobile-nav-toggle {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 900;
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        /* Overlay for mobile menu */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 950;
        }

        /* --- STYLES --- */
        .exec-summary-card {
            background: linear-gradient(to right, #ffffff, #f4f6f9);
            border-left: 6px solid var(--accent);
            padding: 2.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 4rem;
        }
        .exec-summary-content ul { padding-left: 20px; margin: 0; }
        .exec-summary-content li { margin-bottom: 14px; font-size: 1.05rem; line-height: 1.7; color: #34495e; }
        .exec-summary-content strong { color: var(--accent); font-weight: 600; }

        .section-intro { 
            background: #eef6fc; 
            padding: 1.5rem; 
            border-radius: 8px; 
            margin-bottom: 2rem; 
            border: 1px solid #d6eaf8; 
            color: #2c3e50; 
            line-height: 1.6;
        }
        
        .section-header { 
            border-bottom: 2px solid #e1e8ef; 
            margin-bottom: 2rem; 
            padding-bottom: 0.5rem; 
            margin-top: 5rem; 
            display: flex; 
            align-items: center; 
        }
        .section-header h2 { font-size: 1.6rem; margin: 0; color: var(--secondary); font-weight: 700; }
        
        .card { background: var(--card-bg); border-radius: 10px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.03); border: 1px solid var(--border); }
        .card h3 { margin-top: 0; color: var(--primary); font-size: 1.2rem; margin-bottom: 1.5rem; }

        .grid-2 { display: grid; grid-template-columns: 65% 35%; gap: 2rem; }
        
        .ai-box { background: #f8f9fa; padding: 1.5rem; border-radius: 8px; border: 1px solid #eee; height: fit-content; }
        .ai-label { background: var(--primary); color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px; display: inline-block; margin-bottom: 1rem; }
        .ai-text p { margin: 0; font-size: 0.95rem; color: #34495e; line-height: 1.6; }

        .table-responsive { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .custom-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; min-width: 600px; }
        .custom-table th { background: #f1f2f6; padding: 12px 15px; text-align: left; font-weight: 600; color: var(--secondary); white-space: nowrap; border-bottom: 2px solid #dfe6e9; }
        .custom-table td { padding: 12px 15px; border-bottom: 1px solid #eee; vertical-align: top; }
        .custom-table tr:hover { background-color: #fcfcfc; }
        
        .download-btn { display: inline-block; margin-top: 15px; font-size: 0.8rem; text-decoration: none; opacity: 0.9; }
        .download-btn:hover { opacity: 1; }

        /* --- RESPONSIVE MEDIA QUERIES --- */
        @media (max-width: 992px) {
            .sidebar { transform: translateX(-100%); width: 280px; }
            .sidebar.active { transform: translateX(0); }
            .sidebar-overlay.active { display: block; }
            .close-sidebar-btn { display: block; }
            
            .main-content { margin-left: 0; padding: 5rem 1.5rem 2rem 1.5rem; }
            .mobile-nav-toggle { display: block; }
            .grid-2 { grid-template-columns: 1fr; }
            
            h1 { font-size: 1.8rem !important; }
            .section-header { margin-top: 3rem; }
            .plot-container { order: 1; margin-bottom: 1.5rem; }
            .ai-box { order: 2; }
        }
    </style>
</head>
<body>

    <button class="mobile-nav-toggle" id="navToggle">
        <i class="fa-solid fa-bars"></i>
    </button>
    
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <nav class="sidebar" id="sidebar">
        <div class="close-sidebar-btn" id="closeSidebar"><i class="fa-solid fa-times"></i></div>
        
        <h2><i class="fa-solid fa-landmark"></i> Macro Policy Hub</h2>
        
        <ul class="nav-links">
            <li><a href="#summary">Executive Summary</a></li>
            
            <div class="nav-group">Part I: CCyB Monitor</div>
            <li><a href="#ccyb-intro">Overview</a></li>
            <li><a href="#ccyb-decisions">Decisions</a></li>
            <li><a href="#ccyb-diffusion">Diffusion</a></li>
            <li><a href="#ccyb-risk">Risk Analysis</a></li>
            
            <div class="nav-group">Part II: SyRB Monitor</div>
            <li><a href="#syrb-intro">Overview</a></li>
            <li><a href="#syrb-trends">Trends</a></li>
            <li><a href="#syrb-data">Policy Data</a></li>
        </ul>
        
        <div style="margin-top: 3rem; font-size: 0.75rem; color: rgba(255,255,255,0.4); border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1rem;">
            Generated: {{ generation_date }}<br>
            Source: ESRB / AI Analysis
        </div>
    </nav>

    <main class="main-content">
        
        <div style="margin-bottom: 3.5rem;">
            <h1 style="font-size: 2.4rem; color: var(--primary); margin: 0; font-weight: 700;">EU Macroprudential Dashboard</h1>
            <div style="color: #7f8c8d; margin-top: 0.8rem; font-size: 1.1rem;">Comprehensive analysis of CCyB and SyRB measures</div>
        </div>

        <section id="summary" class="exec-summary-card">
            <h2 style="display: flex; align-items: center;"><i class="fa-solid fa-layer-group" style="color: var(--accent); margin-right: 12px;"></i> Global Executive Summary</h2>
            <div class="exec-summary-content">
                {{ analyses.executive_summary | safe }}
            </div>
        </section>

        <div class="section-header" id="ccyb-intro">
            <h2>Part I: Countercyclical Capital Buffer (CCyB)</h2>
        </div>

        <div class="section-intro">
            <strong><i class="fa-solid fa-circle-info" style="color: var(--accent);"></i> Section Overview:</strong> 
            <div style="margin-top: 8px;">{{ analyses.ccyb_executive_summary }}</div>
        </div>

        <div class="card" id="ccyb-decisions">
            <h3>Recent Policy Decisions</h3>
            <div class="grid-2">
                <div class="table-responsive" style="grid-column: span 2;">
                    {{ policy_table_html | safe }}
                </div>
            </div>
            <div class="ai-box" style="margin-top: 1rem;">
                <span class="ai-label">Driver Analysis</span>
                <div class="ai-text"><p>{{ analyses.policy_driver_analysis }}</p></div>
            </div>
        </div>

        <div class="card" id="ccyb-diffusion">
            <h3>Strategic Diffusion</h3>
            <div class="grid-2">
                <div class="plot-container">{{ plots.diffusion_plot | safe }}</div>
                <div class="ai-box">
                    <span class="ai-label">AI Analysis</span>
                    <div class="ai-text"><p>{{ analyses.strategic_diffusion_analysis }}</p></div>
                </div>
            </div>
        </div>

        <div class="card" id="ccyb-risk">
            <h3>Risk Analysis</h3>
            <div class="grid-2">
                <div class="plot-container">{{ plots.risk_plot | safe }}</div>
                <div class="ai-box">
                    <span class="ai-label">Decoupling Insight</span>
                    <div class="ai-text"><p>{{ analyses.risk_decoupling }}</p></div>
                </div>
            </div>
        </div>

        <div class="section-header" id="syrb-intro">
            <h2>Part II: Systemic Risk Buffer (SyRB)</h2>
        </div>

        <div class="section-intro">
            <strong><i class="fa-solid fa-circle-info" style="color: var(--accent);"></i> Section Overview:</strong>
            <div style="margin-top: 8px;">{{ analyses.syrb_executive_summary }}</div>
        </div>

        <div class="card" id="syrb-trends">
            <h3>Adoption Trends (General vs Sectoral)</h3>
            <div class="grid-2">
                <div class="plot-container">{{ plots.syrb_diffusion_plot | safe }}</div>
                <div class="ai-box">
                    <span class="ai-label">Trend Analysis</span>
                    <div class="ai-text"><p>{{ analyses.syrb_diffusion_analysis }}</p></div>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>Sectoral Focus</h3>
            <div class="grid-2">
                <div class="plot-container">{{ plots.syrb_sector_plot | safe }}</div>
                <div class="ai-box">
                    <span class="ai-label">Sectoral Insight</span>
                    <div class="ai-text"><p>{{ analyses.syrb_sectoral_focus }}</p></div>
                </div>
            </div>
        </div>

        <div class="card" id="syrb-data">
            <h3>SyRB Policy Data Analysis</h3>
            <div class="grid-2">
                <div style="grid-column: span 2;">
                    <div class="ai-box" style="margin-bottom: 1.5rem; background: #fffbf0; border-color: #f7e8bc;">
                        <span class="ai-label" style="background: #f39c12;">Data Insight</span>
                        <div class="ai-text"><p>{{ analyses.syrb_table_analysis }}</p></div>
                    </div>
                </div>
                
                <div class="table-responsive" style="grid-column: span 2;">
                    <h4 style="margin-top:0; color:var(--secondary);">Latest 10 Decisions</h4>
                    {{ syrb_decisions_html | safe }}
                </div>

                <div class="table-responsive" style="grid-column: span 2; margin-top: 2.5rem;">
                    <h4 style="margin-top:0; color:var(--secondary);">Active Sectoral Measures</h4>
                    {{ syrb_status_html | safe }}
                </div>
            </div>
        </div>

    </main>

    <script>
        const navToggle = document.getElementById('navToggle');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        const closeBtn = document.getElementById('closeSidebar');
        const navLinks = document.querySelectorAll('.nav-links a');

        function toggleMenu() {
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        function closeMenu() {
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
        }

        navToggle.addEventListener('click', toggleMenu);
        overlay.addEventListener('click', closeMenu);
        closeBtn.addEventListener('click', closeMenu);

        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 992) {
                    closeMenu();
                }
            });
        });

        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>